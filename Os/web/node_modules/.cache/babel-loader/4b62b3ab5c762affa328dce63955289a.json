{"ast":null,"code":"import \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.fill.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as echarts from 'echarts';\nexport default {\n  name: 'IncomeChart',\n  data: function data() {\n    return {\n      sumIncome: 0,\n      categoryIncomes: [],\n      categoryNames: [],\n      incomes: [],\n      activeName: 'bar',\n      totalAll: 0,\n      totalWeek: 0,\n      totalMonth: 0,\n      total: 0,\n      selectedDate: new Date(),\n      dayLineChart: null\n    };\n  },\n  methods: {\n    handleDateChange: function handleDateChange(value) {\n      this.fetchHourlyTransactions(value);\n    },\n    fetchHourlyTransactions: function fetchHourlyTransactions(date) {\n      var _this = this;\n\n      var formattedDate = this.formatDate(date);\n      this.request.get(\"/api/income/day?date=\".concat(formattedDate)).then(function (res) {\n        if (res.code === '200') {\n          _this.updateDayLineChart(res.data.hourlyTransactions);\n        }\n      });\n    },\n    updateDayLineChart: function updateDayLineChart(hourlyTransactions) {\n      var hours = Array.from({\n        length: 24\n      }, function (_, i) {\n        return \"\".concat(i, \":00-\").concat(i + 1, \":00\");\n      });\n      var data = Array(24).fill(0);\n      hourlyTransactions.forEach(function (item) {\n        if (item.hour < 24) {\n          // 确保小时数不超过23\n          data[item.hour] = item.count;\n        }\n      });\n      var option = {\n        tooltip: {\n          trigger: 'item'\n        },\n        title: {\n          text: '日流量分析',\n          x: 'center'\n        },\n        xAxis: {\n          type: 'category',\n          data: hours,\n          axisLabel: {\n            rotate: 45,\n            interval: 0\n          }\n        },\n        yAxis: {\n          type: 'value'\n        },\n        series: [{\n          data: data,\n          type: 'line',\n          smooth: true\n        }]\n      };\n      this.dayLineChart.setOption(option, true);\n    },\n    formatDate: function formatDate(date) {\n      return date.toISOString().slice(0, 10); // 转换日期为 YYYY-MM-DD 格式\n    },\n    handleClick: function handleClick(tab) {\n      switch (tab.name) {\n        case 'bar':\n          this.total = this.totalAll;\n          break;\n\n        case 'pie':\n          this.total = this.totalAll;\n          break;\n\n        case 'line1':\n          this.total = this.totalWeek;\n          break;\n\n        case 'line2':\n          this.total = this.totalMonth;\n          break;\n\n        case 'line3':\n          this.total = this.calculateDailyTotal();\n          break;\n        // 例如，计算每日总计的方法\n      }\n    }\n  },\n  mounted: function mounted() {\n    this.dayLineChart = echarts.init(document.getElementById('dayLine'));\n    this.fetchHourlyTransactions(this.selectedDate);\n  },\n  filters: {\n    numFilter: function numFilter(value) {\n      return Number(Number(value).toFixed(2)); // 截取当前数据到小数点后两位，转换为数字\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;AAEA;AACAA,qBADA;AAEAC,MAFA,kBAEA;AACA;AACAC,kBADA;AAEAC,yBAFA;AAGAC,uBAHA;AAIAC,iBAJA;AAKAC,uBALA;AAMAC,iBANA;AAOAC,kBAPA;AAQAC,mBARA;AASAC,cATA;AAUAC,8BAVA;AAWAC;AAXA;AAaA,GAhBA;AAiBAC;AACAC,oBADA,4BACAC,KADA,EACA;AACA;AACA,KAHA;AAIAC,2BAJA,mCAIAC,IAJA,EAIA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA,KAXA;AAYAC,sBAZA,8BAYAC,kBAZA,EAYA;AACA;AAAAC;AAAA;AAAA;AAAA;AACA;AACAD;AACA;AAAA;AACAlB;AACA;AACA,OAJA;AAKA;AACAoB;AAAAC;AAAA,SADA;AAEAC;AAAAC;AAAAC;AAAA,SAFA;AAGAC;AAAAC;AAAA1B;AAAA2B;AAAAC;AAAAC;AAAA;AAAA,SAHA;AAIAC;AAAAJ;AAAA,SAJA;AAKAK;AAAA/B;AAAA0B;AAAAM;AAAA;AALA;AAOA;AACA,KA5BA;AA6BAC,cA7BA,sBA6BAjB,IA7BA,EA6BA;AACA,6CADA,CACA;AACA,KA/BA;AAgCAkB,eAhCA,uBAgCAC,GAhCA,EAgCA;AACA;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;;AACA;AAAA;AAAA;AAAA;AALA;AAOA;AAxCA,GAjBA;AA2DAC,SA3DA,qBA2DA;AACA;AACA;AACA,GA9DA;AA+DAC;AACAC,aADA,qBACAxB,KADA,EACA;AACA,8CADA,CACA;AACA;AAHA;AA/DA","names":["name","data","sumIncome","categoryIncomes","categoryNames","incomes","activeName","totalAll","totalWeek","totalMonth","total","selectedDate","dayLineChart","methods","handleDateChange","value","fetchHourlyTransactions","date","updateDayLineChart","hourlyTransactions","length","tooltip","trigger","title","text","x","xAxis","type","axisLabel","rotate","interval","yAxis","series","smooth","formatDate","handleClick","tab","mounted","filters","numFilter"],"sourceRoot":"src/views/manage/income","sources":["IncomeChart.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <el-tabs v-model=\"activeName\" @tab-click=\"handleClick\">\r\n      <el-card\r\n          style=\"display: inline-block; margin-left: 50px; margin-top: 30px; font-weight: bold; font-size: 22px; color: #ffb02a;\">\r\n        ￥总计：{{ total | numFilter }}\r\n      </el-card>\r\n\r\n      <!-- 柱状图 -->\r\n      <el-tab-pane label=\"各类收入柱状图\" name=\"bar\">\r\n        <div id=\"bar\" style=\"width: 1200px; height: 500px; margin: auto;\"></div>\r\n      </el-tab-pane>\r\n\r\n      <!-- 饼图 -->\r\n      <el-tab-pane label=\"各类收入饼图\" name=\"pie\">\r\n        <div id=\"pie\" style=\"width: 600px; height: 600px; margin: 10px auto;\"></div>\r\n      </el-tab-pane>\r\n\r\n      <!-- 本周收入折线图 -->\r\n      <el-tab-pane label=\"本周收入\" name=\"line1\">\r\n        <div id=\"weekLine\" style=\"width: 900px; height: 500px; margin: 10px auto;\"></div>\r\n      </el-tab-pane>\r\n\r\n      <!-- 本月收入折线图 -->\r\n      <el-tab-pane label=\"本月收入\" name=\"line2\">\r\n        <div id=\"monthLine\" style=\"width: 1500px; height: 500px; margin: 10px auto;\"></div>\r\n      </el-tab-pane>\r\n\r\n      <!-- 日流量分析 -->\r\n      <el-tab-pane label=\"日流量分析\" name=\"line3\">\r\n        <el-date-picker\r\n            v-model=\"selectedDate\"\r\n            type=\"date\"\r\n            placeholder=\"选择日期\"\r\n            style=\"margin-bottom: 20px;\"\r\n            @change=\"handleDateChange\">\r\n        </el-date-picker>\r\n        <div id=\"dayLine\" style=\"width: 1500px; height: 500px; margin: 10px auto\"></div>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as echarts from 'echarts';\r\n\r\nexport default {\r\n  name: 'IncomeChart',\r\n  data() {\r\n    return {\r\n      sumIncome: 0,\r\n      categoryIncomes: [],\r\n      categoryNames: [],\r\n      incomes: [],\r\n      activeName: 'bar',\r\n      totalAll: 0,\r\n      totalWeek: 0,\r\n      totalMonth: 0,\r\n      total: 0,\r\n      selectedDate: new Date(),\r\n      dayLineChart: null,\r\n    };\r\n  },\r\n  methods: {\r\n    handleDateChange(value) {\r\n      this.fetchHourlyTransactions(value);\r\n    },\r\n    fetchHourlyTransactions(date) {\r\n      let formattedDate = this.formatDate(date);\r\n      this.request.get(`/api/income/day?date=${formattedDate}`).then((res) => {\r\n        if (res.code === '200') {\r\n          this.updateDayLineChart(res.data.hourlyTransactions);\r\n        }\r\n      });\r\n    },\r\n    updateDayLineChart(hourlyTransactions) {\r\n      let hours = Array.from({ length: 24 }, (_, i) => `${i}:00-${i + 1}:00`);\r\n      let data = Array(24).fill(0);\r\n      hourlyTransactions.forEach(item => {\r\n        if (item.hour < 24) { // 确保小时数不超过23\r\n          data[item.hour] = item.count;\r\n        }\r\n      });\r\n      let option = {\r\n        tooltip: { trigger: 'item' },\r\n        title: { text: '日流量分析', x: 'center' },\r\n        xAxis: { type: 'category', data: hours, axisLabel: { rotate: 45, interval: 0 } },\r\n        yAxis: { type: 'value' },\r\n        series: [{ data: data, type: 'line', smooth: true }]\r\n      };\r\n      this.dayLineChart.setOption(option, true);\r\n    },\r\n    formatDate(date) {\r\n      return date.toISOString().slice(0, 10); // 转换日期为 YYYY-MM-DD 格式\r\n    },\r\n    handleClick(tab) {\r\n      switch (tab.name) {\r\n        case 'bar': this.total = this.totalAll; break;\r\n        case 'pie': this.total = this.totalAll; break;\r\n        case 'line1': this.total = this.totalWeek; break;\r\n        case 'line2': this.total = this.totalMonth; break;\r\n        case 'line3': this.total = this.calculateDailyTotal(); break; // 例如，计算每日总计的方法\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.dayLineChart = echarts.init(document.getElementById('dayLine'));\r\n    this.fetchHourlyTransactions(this.selectedDate);\r\n  },\r\n  filters: {\r\n    numFilter(value) {\r\n      return Number(Number(value).toFixed(2)); // 截取当前数据到小数点后两位，转换为数字\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}